# 工具类



## CommonUtil（获取客户端ip,md5加密，获取时间戳，生成32位随机uuid，根据传入位数获取随机数0-9）

```
/**
     * 获取ip
     * @param request
     * @return
     */
    public static String getIpAddr(HttpServletRequest request) {
        String ipAddress = null;
        try {
            ipAddress = request.getHeader("x-forwarded-for");
            if (ipAddress == null || ipAddress.length() == 0 || "unknown".equalsIgnoreCase(ipAddress)) {
                ipAddress = request.getHeader("Proxy-Client-IP");
            }
            if (ipAddress == null || ipAddress.length() == 0 || "unknown".equalsIgnoreCase(ipAddress)) {
                ipAddress = request.getHeader("WL-Proxy-Client-IP");
            }
            if (ipAddress == null || ipAddress.length() == 0 || "unknown".equalsIgnoreCase(ipAddress)) {
                ipAddress = request.getRemoteAddr();
                if (ipAddress.equals("127.0.0.1")) {
                    // 根据网卡取本机配置的IP
                    InetAddress inet = null;
                    try {
                        inet = InetAddress.getLocalHost();
                    } catch (UnknownHostException e) {
                        e.printStackTrace();
                    }
                    ipAddress = inet.getHostAddress();
                }
            }
            // 对于通过多个代理的情况，第一个IP为客户端真实IP,多个IP按照','分割
            if (ipAddress != null && ipAddress.length() > 15) {
                // "***.***.***.***".length()
                // = 15
                if (ipAddress.indexOf(",") > 0) {
                    ipAddress = ipAddress.substring(0, ipAddress.indexOf(","));
                }
            }
        } catch (Exception e) {
            ipAddress="";
        }
        return ipAddress;
    }



    public static String MD5(String data)  {
        try {
            java.security.MessageDigest md = MessageDigest.getInstance("MD5");
            byte[] array = md.digest(data.getBytes("UTF-8"));
            StringBuilder sb = new StringBuilder();
            for (byte item : array) {
                sb.append(Integer.toHexString((item & 0xFF) | 0x100).substring(1, 3));
            }

            return sb.toString().toUpperCase();
        } catch (Exception exception) {
        }
        return null;

    }
    
    
     /**
     * 获取随机数
     * @param length
     * @return
     */
    public static String getRandomCode(int length){

        String num="0123456789";

        Random random=new Random();
        StringBuilder stringBuilder=new StringBuilder();
        for (int i=0; i<=length; i++){
            stringBuilder.append(num.charAt(random.nextInt(9)));
        }
        return stringBuilder.toString();
    }
    
    
    **
     * 获取时间戳
     */

    public  static long getCurrentTimeStamp(){
        return System.currentTimeMillis();
    }
    
    
    /**
    生成32位随机uuid
    */
    
    public static String generateUUID() {

        return UUID.randomUUID().toString().replaceAll("-","").substring(0,32);
    }
```



## redis序列化反序列化

```
@Configuration
public class RedisTemplateConfiguration {

    /**
     * @param redisConnectionFactory
     * @return
     */
    @Bean
    public RedisTemplate<Object, Object> redisTemplate(RedisConnectionFactory redisConnectionFactory) {

        RedisTemplate<Object, Object> redisTemplate = new RedisTemplate<>();
        redisTemplate.setConnectionFactory(redisConnectionFactory);

        // 使用Jackson2JsonRedisSerialize 替换默认序列化
        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = new Jackson2JsonRedisSerializer(Object.class);

        ObjectMapper objectMapper = new ObjectMapper();
        objectMapper.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);
        jackson2JsonRedisSerializer.setObjectMapper(objectMapper);

        // 设置key和value的序列化规则
        redisTemplate.setKeySerializer(new StringRedisSerializer());
        redisTemplate.setValueSerializer(jackson2JsonRedisSerializer);

        // 设置hashKey和hashValue的序列化规则
        redisTemplate.setHashKeySerializer(new StringRedisSerializer());
        redisTemplate.setHashValueSerializer(jackson2JsonRedisSerializer);

        // 设置支持事物
        //redisTemplate.setEnableTransactionSupport(true);

        redisTemplate.afterPropertiesSet();

        return redisTemplate;
    }

}
```



## JsonData

```
@Data
@AllArgsConstructor
@NoArgsConstructor
public class JsonData {
    /**
     * 状态码 0 表示成功，1表示处理中，-1表示失败
     */

    private Integer code;
    /**
     * 数据
     */
    private Object data;
    /**
     * 描述
     */
    private String msg;

	/**
     * 获取远程调用数据
     * 注意事项：
     * 支持多单词下划线专驼峰（序列化和反序列化）
     * @param typeReference
     * @param <T>
     * @return
     */
    public <T> T getData(TypeReference<T> typeReference){
        return JSON.parseObject(JSON.toJSONString(data),typeReference);
    }

    /**
     * 成功，传入数据
     * @return
     */
    public static JsonData buildSuccess() {
        return new JsonData(0, null, null);
    }

    /**
     *  成功，传入数据
     * @param data
     * @return
     */
    public static JsonData buildSuccess(Object data) {
        return new JsonData(0, data, null);
    }

    /**
     * 失败，传入描述信息
     * @param msg
     * @return
     */
    public static JsonData buildError(String msg) {
        return new JsonData(-1, null, msg);
    }


    /**
     * 自定义状态码和错误信息
     * @param code
     * @param msg
     * @return
     */
    public static JsonData buildCodeAndMsg(int code, String msg) {
        return new JsonData(code, null, msg);
    }

    /**
     * 传入枚举，返回信息
     * @param codeEnum
     * @return
     */
    public static JsonData buildResult(BizCodeEnum codeEnum){
        return JsonData.buildCodeAndMsg(codeEnum.getCode(),codeEnum.getMessage());
    }
}

```



## 获取当前时间戳转换为 yyyy/MM/dd

```
 LocalDateTime ldt=LocalDateTime.now();
        DateTimeFormatter dtf = DateTimeFormatter.ofPattern("yyyy/MM/dd");
        String folder=dtf.format(ldt);
```



## MD5+盐（加密）

依赖

```
  <!-- https://mvnrepository.com/artifact/org.apache.commons/commons-lang3 -->
            <dependency>
                <groupId>org.apache.commons</groupId>
                <artifactId>commons-lang3</artifactId>
                <version>${commons.lang3.version}</version>
            </dependency>

            <!-- https://mvnrepository.com/artifact/commons-codec/commons-codec -->
            <!--用于加密-->
            <dependency>
                <groupId>commons-codec</groupId>
                <artifactId>commons-codec</artifactId>
                <version>${commons.codec.version}</version>
            </dependency>
```



用法

```

```





















# 配置文件



## 数据库连接

```
#数据库配置
  datasource:
    driver-class-name: com.mysql.cj.jdbc.Driver
    url: jdbc:mysql://47.108.218.125:3306/xdclass_user?useUnicode=true&characterEncoding=utf-8&useSSL=false&serverTimezone=Asia/Shanghai
    username: root
    password: xxxx
```



## mybatis-plus打印sql日志

```
#配置plus打印sql日志
mybatis-plus:
  configuration:
    log-impl: org.apache.ibatis.logging.stdout.StdOutImpl
```



## swagger配置文件

```
@Component
@Data
@EnableOpenApi
public class SwaggerConfiguration {

    @Bean
    public Docket webApiDoc(){


        return new Docket(DocumentationType.OAS_30)
                .groupName("用户端接口文档")
                .pathMapping("/")
                // 定义是否开启swagger，false为关闭，可以通过变量控制，线上关闭
                .enable(true)
                //配置api文档元信息
                .apiInfo(apiInfo())
                // 选择哪些接口作为swagger的doc发布
                .select()
                .apis(RequestHandlerSelectors.basePackage("work.yspan"))
                //正则匹配请求路径，并分配至当前分组
                .paths(PathSelectors.ant("/api/**"))
                .build()
                .globalRequestParameters(getGlobalRequestParameters())
                .globalResponses(HttpMethod.GET,getGlobalResponseMessage());

    }


    @Bean
    public Docket adminApiDoc(){

        return new Docket(DocumentationType.OAS_30)
                .groupName("管理端接口文档")
                .pathMapping("/")
                // 定义是否开启swagger，false为关闭，可以通过变量控制，线上关闭
                .enable(true)
                //配置api文档元信息
                .apiInfo(apiInfo())
                // 选择哪些接口作为swagger的doc发布
                .select()
                .apis(RequestHandlerSelectors.basePackage("work.yspan"))
                //正则匹配请求路径，并分配至当前分组
                .paths(PathSelectors.ant("/admin/**"))
                .build();
    }

    private ApiInfo apiInfo() {
        return new ApiInfoBuilder()
                .title("1024电商平台")
                .description("微服务接口文档")
                .contact(new Contact("小帅", "https://yspan.work", "88888888@qq.com"))
                .version("1")
                .build();
    }

    private List<RequestParameter> getGlobalRequestParameters() {
        List<RequestParameter> list=new ArrayList<>();
        list.add( new RequestParameterBuilder()
                .name("token")
                .description("登录令牌")
                .in(ParameterType.HEADER)
                .query(q -> q.model(m -> m.scalarModel(ScalarType.STRING)))
                .required(false)
                .build());

//        当有多个时的写法
//        list.add( new RequestParameterBuilder()
//                .name("token")
//                .description("登录令牌")
//                .in(ParameterType.HEADER)
//                .query(q -> q.model(m -> m.scalarModel(ScalarType.STRING)))
//                .required(true)
//                .build());

        return list;
    }

    private List<Response> getGlobalResponseMessage() {
        List<Response> list=new ArrayList<>();
        list.add(
                new ResponseBuilder()
                        .code("4xx")
                        .description("请求错误，根据code和msg检查")
                        .build());
        return list;
    }

}
```



## 谷歌验证码配置文件

依赖

```
 <!--kaptcha依赖包-->
            <dependency>
                <groupId>com.baomidou</groupId>
                <artifactId>kaptcha-spring-boot-starter</artifactId>
                <version>1.1.0</version>
            </dependency>
```



```
@Configuration
public class CaptchaConfig {
    /**
     * 验证码配置
     * Kaptcha配置类名

     *
     * @return
     */
    @Bean
    @Qualifier("captchaProducer")
    public DefaultKaptcha kaptcha() {
        DefaultKaptcha kaptcha = new DefaultKaptcha();
        Properties properties = new Properties();
//		properties.setProperty(Constants.KAPTCHA_BORDER, "yes");
//		properties.setProperty(Constants.KAPTCHA_BORDER_COLOR, "220,220,220");
//		//properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_COLOR, "38,29,12");
//		properties.setProperty(Constants.KAPTCHA_IMAGE_WIDTH, "147");
//		properties.setProperty(Constants.KAPTCHA_IMAGE_HEIGHT, "34");
//		properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_SIZE, "25");
//		//properties.setProperty(Constants.KAPTCHA_SESSION_KEY, "code");
        //验证码个数
        properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_CHAR_LENGTH, "4");
//		properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_FONT_NAMES, "Courier");
        //字体间隔
        properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_CHAR_SPACE,"8");
        //干扰线颜色
//		properties.setProperty(Constants.KAPTCHA_NOISE_COLOR, "white");
        //干扰实现类
        properties.setProperty(Constants.KAPTCHA_NOISE_IMPL, "com.google.code.kaptcha.impl.NoNoise");
        //图片样式
        properties.setProperty(Constants.KAPTCHA_OBSCURIFICATOR_IMPL, "com.google.code.kaptcha.impl.WaterRipple");
        //文字来源
        properties.setProperty(Constants.KAPTCHA_TEXTPRODUCER_CHAR_STRING, "0123456789");
        Config config = new Config(properties);
        kaptcha.setConfig(config);
        return kaptcha;
    }
}

```



## nacos配置中心配置文件

![image-20220919230619786](D:\work\TyporaImg\image-20220919230619786.png)



## 分页插件（mybatis-plus）

配置文件

```
@Configuration
public class MybatisPlusPageConfig {

    /**
     * 旧版配置
     * @return
     */
//    public PaginationInnerInterceptor paginationInnerInterceptor(){
//        return new PaginationInnerInterceptor();
//    }

    /**
     * 新版配置
     * @return
     */
    @Bean
    public MybatisPlusInterceptor mybatisPlusInterceptor(){
        MybatisPlusInterceptor interceptor=new MybatisPlusInterceptor();
        interceptor.addInnerInterceptor(new PaginationInnerInterceptor(DbType.MYSQL));
        return interceptor;
    }
}
```

使用

```
@Service
public class CouponServiceImpl implements CouponService {

    @Autowired
    private CouponMapper couponMapper;

    @Override
    public Map<String, Object> pageCouponActivity(int page, int size) {

        Page<CouponDO> pageinfo=new Page<>(page,size);

        IPage<CouponDO> couponDOPage = couponMapper.selectPage(pageinfo, new QueryWrapper<CouponDO>().
                eq("publish", CouponPublishEnum.PUBLISH.name())
                .eq("category", CouponCategoryEnum.PROMOTION.name())
                .orderByDesc("create_time"));


        Map<String,Object> pageMap=new HashMap<>(3);
        //总条数
        pageMap.put("total_record",couponDOPage.getTotal());
        //总页数
        pageMap.put("total_page",couponDOPage.getPages());

        pageMap.put("current_data",couponDOPage.getRecords().stream().map(obj->beanProcess(obj)).collect(Collectors.toList()));


        return pageMap;
    }

    private CouponVO beanProcess(CouponDO couponDO) {
        CouponVO couponVO=new CouponVO();
        BeanUtils.copyProperties(couponDO,couponVO);
        return couponVO;
    }

}

```

![image-20220828195404563](D:\work\TyporaImg\image-20220828195404563.png)





# 注解



## VO类时间戳转换

```

```

![image-20220831170808233](D:\work\TyporaImg\image-20220831170808233.png)



# String字符串数据处理

## 字符串指定内容替换

![image-20220826233631965](D:\work\TyporaImg\image-20220826233631965.png)





# 类型转换



## 同一个包下的DO转VO

```
BeanUtils.copyproperties(do,vo)
```

<img src="D:\work\TyporaImg\image-20220914220117945.png" alt="image-20220914220117945" style="zoom:50%;" />



## 列表数据类型转换

```
List<obj1> obj1;
List<obj2> objs=obj.stream.map(obj ->{
	obj2 obj2s=new obj2;
	obj2s.setparams1=obj.getparams1;
	obj2s.setparams2=obj.getparams2;
	obj2s.setparams3=obj.getparams3;
	retrun obj2s;
})
```



## Jsondata中的数据（Data）转换

```
/**
 * 获取远程调用数据
 * 注意事项：
 * 支持多单词下划线专驼峰（序列化和反序列化）
 * @param typeReference
 * @param <T>
 * @return
 */
public <T> T getData(TypeReference<T> typeReference){
    return JSON.parseObject(JSON.toJSONString(data),typeReference);
}
```

![image-20220914222338856](D:\work\TyporaImg\image-20220914222338856.png)

![image-20220914222400083](D:\work\TyporaImg\image-20220914222400083.png)





# 时间转换

## date =>string

```
 		Date createTime = video1.getCreateTime();//从数据库中获取到了Date类型的时间
        SimpleDateFormat simpleDateFormat=new SimpleDateFormat("yyyy:MM:dd HH:mm:ss");
        String format = simpleDateFormat.format(createTime);
```

## LocalDateTime =>String

```
	 LocalDateTime localDateTime=LocalDateTime.now();
        String format1 = localDateTime.format(DateTimeFormatter.ofPattern("yyyy:MM:dd HH:mm:ss"));
```



## String =>LocalDateTime(2048-12-12T12:12:12)

```
 		String time="2048-12-12 12-12-12";
        LocalDateTime parse = LocalDateTime.parse(time, DateTimeFormatter.ofPattern("yyyy-MM-dd HH-mm-ss"));
```



## String =>Date(Sat Dec 12 12:12:12 CST 2048)

```
Date date=null;
        try {
            String time2="2048-12-12 12-12-12";
            date= new SimpleDateFormat("yyyy-MM-dd HH-mm-ss").parse(time2);
        } catch (ParseException e) {
            e.printStackTrace();
        }
```

